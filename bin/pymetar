#!/usr/bin/env python3
# -*- coding: iso-8859-15 -*-

__version__ = "1.4"

import pymetar
import sys

if len(sys.argv) < 2 or sys.argv[1] == "--help":
    sys.stderr.write("Usage: %s <station id>\n" % sys.argv[0])
    sys.stderr.write(
        "Station IDs can be found at: https://www.aviationweather.gov/metar\n")
    sys.exit(1)
elif (sys.argv[1] == "--version"):
    print("%s v%s using pymetar lib v%s" %
          (sys.argv[0], __version__, pymetar.__version__))
    sys.exit(0)
else:
    station = sys.argv[1].upper()

try:
    pr = pymetar.FetchReport(station)
except Exception as e:
    sys.stderr.write("Something went wrong when fetching the report.\n")
    sys.stderr.write("These usually are transient problems if the station ")
    sys.stderr.write("ID is valid. \nThe error encountered was:\n")
    sys.stderr.write(str(e) + "\n")
    sys.exit(1)

pr.ParseReport()

print("Weather report for %s (%s) as of %s" %
      (pr.StationName, station, pr.ISOTime))
print("Values of \"None\" indicate that the value is missing from the report.")
print("Temperature: %s C / %s F" %
      (pr.TemperatureCelsius, pr.TemperatureFahrenheit))
if pr.Windchill and pr.WindchillF:
    print("Wind chill: %.2f C / %.2f F" %
          (pr.Windchill, pr.WindchillF))

print("Rel. Humidity: %s%%" % (pr.Humidity))
if pr.WindSpeed is not None:
    print("Wind speed: %0.2f m/s (%i Bft, %0.2f knots)" %
          (pr.WindSpeed, pr.WindSpeedBeaufort,
           pr.WindSpeedKnots))
else:
    print("Wind speed: None")

print("Wind direction: %s deg (%s)" %
      (pr.WindDirection, pr.WindCompass))
if pr.Pressure is not None:
    print("Pressure: %s hPa" % (int(pr.Pressure)))
else:
    print("Pressure: None")

print("Dew Point: %s C / %s F" %
      (pr.DewPointCelsius, pr.DewPointFahrenheit))
print("Weather: %s" % (pr.Weather))
print("Cloudtype: %s" % (pr.Cloudtype))
print("Sky Conditions: %s" % (pr.SkyConditions))
